{% macro database_panel(panel_id, title, filters_content, results_content, details_content) %}
<div x-data="databasePanel('{{ panel_id }}')"
     x-show="activePanel === '{{ panel_id }}'" 
     @update-pagination-{{ panel_id }}.window="handlePaginationUpdate($event.detail)"
     @reset-pagination-{{ panel_id }}.window="handlePaginationReset()"
     @set-sort.window="if($event.detail.panelId === undefined || $event.detail.panelId === '{{ panel_id }}') { sortBy = $event.detail.sortBy }"
     class="h-[calc(100vh-20rem)] w-full flex gap-4 justify-center items-start">
    
    <!-- Container to limit max width and center content -->
    <div class="w-full max-w-[1400px] h-full flex gap-4">
        <!-- Left Column - Filters -->
        <div class="w-56 bg-lotro-dark rounded-lg border border-lotro-border p-4 flex-shrink-0 flex flex-col h-full">
            <h3 class="text-lg font-medium text-lotro-gold mb-4">Filters</h3>
            <div class="flex-1 overflow-y-auto">
                {{ filters_content }}
            </div>
        </div>

        <!-- Middle Column - Results Grid -->
        <div class="flex-1 bg-lotro-dark rounded-lg border border-lotro-border flex flex-col min-w-[800px] h-full">
            <!-- Header with Search -->
            <div class="p-4 border-b border-lotro-border flex-shrink-0">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-lotro-gold">{{ title }}</h2>
                    <div class="flex items-center gap-4">
                        <!-- Results Counter -->
                        <div class="text-sm text-lotro-secondary">
                            <span x-text="totalResults ? `Showing ${items.length} out of ${totalResults} results` : `Showing ${items.length} results`"></span>
                        </div>
                        <!-- Sort By dropdown -->
                        <select x-model="sortBy" 
                                @change="handleSortChange()"
                                class="bg-lotro-darker text-lotro-primary px-3 py-1 rounded border border-lotro-border focus:border-lotro-gold focus:outline-none">
                            <option value="recent">Recent</option>
                            <option value="name">Name</option>
                            <option value="base_ilvl">Base iLvl</option>
                            <option value="ev" x-show="'{{ panel_id }}' === 'equipment' && isBuilderMode()">Essence Value</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-2">
                    <input type="text" 
                           placeholder="Search..." 
                           class="flex-1 bg-lotro-darker text-lotro-primary px-4 py-2 rounded border border-lotro-border focus:border-lotro-gold focus:outline-none">
                </div>
            </div>

            <!-- Results Grid - Now scrollable -->
            <div class="flex-1 overflow-y-auto">
                <div class="p-4">
                    {{ results_content }}
                    
                    <!-- Load More Button or End Message -->
                    <div class="mt-4 text-center">
                        <template x-if="hasMore">
                            <button @click="loadMore" 
                                    class="bg-lotro-darker text-lotro-gold px-6 py-2 rounded border border-lotro-border hover:border-lotro-gold focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed"
                                    :disabled="loading">
                                <span x-show="!loading">Load More</span>
                                <span x-show="loading" class="inline-flex items-center">
                                    <span class="animate-pulse mr-2 text-lotro-gold">â—</span>
                                    Loading...
                                </span>
                            </button>
                        </template>
                        <template x-if="!hasMore && items.length > 0">
                            <div class="text-lotro-secondary py-2">
                                No more items to load
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Details Panel -->
        <div class="w-80 bg-lotro-dark rounded-lg border border-lotro-border flex-shrink-0 flex flex-col h-full">
            <!-- Details Header -->
            <div class="p-4 border-b border-lotro-border flex-shrink-0">
                <h3 class="text-lg font-medium text-lotro-gold">Details</h3>
            </div>
            
            <!-- Scrollable Details Content -->
            <div class="flex-1 overflow-y-auto p-4">
                {{ details_content }}
            </div>
            
            <!-- Builder Mode: Fixed Bottom Equip Button -->
            <template x-if="isBuilderMode() && hasSelectedItem()">
                <div class="p-4 border-t border-lotro-border bg-lotro-darker flex-shrink-0">
                    <button @click="selectItemForBuild()"
                            class="w-full bg-lotro-gold hover:bg-lotro-gold/80 text-black font-bold py-3 px-4 rounded transition-colors duration-200">
                        Equip <span x-text="getSelectedItemName()"></span>
                    </button>
                </div>
            </template>
        </div>
    </div>
</div>

<!-- Base Panel JavaScript -->
<script src="{{ url_for('static', path='js/database/base-panel.js') }}"></script>
{% endmacro %} 